# Notification System Test Guide

## 🎯 Step 4 验收测试指南

### 测试环境

- 访问 `/notification-test` 页面进行功能测试
- 访问 `/notifications` 页面查看通知列表

### ✅ 验收标准

#### 1. 初始角标显示正确

- [ ] 右上角用户菜单中的通知角标显示正确的未读数量
- [ ] 当没有未读通知时，角标隐藏

#### 2. 进入中心页，点击某条 → 该条从未读变已读，角标数字同步减少

- [ ] 点击通知项，蓝点消失
- [ ] 角标数字实时减少
- [ ] 通知背景从高亮变为正常

#### 3. 点击「Mark all as read」→ 全部变已读，角标归 0

- [ ] 点击 "Mark all as read" 按钮
- [ ] 所有通知变为已读状态
- [ ] 角标归零

#### 4. 刷新页面后，已读状态保留（localStorage 持久）

- [ ] 刷新页面后，已读状态保持不变
- [ ] 角标数量正确显示

### 🧪 测试步骤

#### 准备工作

1. 打开浏览器开发者工具（F12）
2. 访问 `/notification-test` 页面
3. 确保当前用户是 'alice'

#### 测试流程

**测试 1：创建通知**

1. 点击 "Create System Notification" 按钮
2. 检查右上角角标是否显示 "1"
3. 点击 "Create Collaboration Notification" 按钮
4. 检查角标是否显示 "2"

**测试 2：查看通知列表**

1. 点击右上角用户头像 → Notifications
2. 进入 `/notifications` 页面
3. 确认看到 2 条未读通知
4. 确认未读通知有蓝点标记

**测试 3：标记单个通知为已读**

1. 点击第一条通知
2. 确认蓝点消失
3. 确认角标数字减少到 "1"
4. 确认通知背景变为正常

**测试 4：标记全部为已读**

1. 点击 "Mark all as read" 按钮
2. 确认所有通知变为已读
3. 确认角标归零

**测试 5：持久化测试**

1. 刷新页面
2. 确认已读状态保持不变
3. 确认角标数量正确

**测试 6：用户切换测试**

1. 回到 `/notification-test` 页面
2. 点击 "Switch User" 按钮
3. 确认切换到 'bryan' 用户
4. 创建一些测试通知
5. 确认不同用户的通知数据独立

### 🔧 调试信息

在浏览器控制台中可以看到以下调试信息：

- `NavBar: Loaded unread count: X`
- `NotificationCenter: Marked notification as read`
- `NotificationCenter: Marked all as read`
- `Created test notification for user: X`

### 🐛 常见问题

1. **角标不更新**：检查事件监听器是否正确设置
2. **数据不持久**：检查 localStorage 是否正确保存
3. **用户切换不生效**：检查 `user:changed` 事件是否正确触发

### 📝 测试结果记录

| 测试项           | 预期结果           | 实际结果 | 状态 |
| ---------------- | ------------------ | -------- | ---- |
| 初始角标显示     | 显示正确数量       |          |      |
| 点击通知标记已读 | 角标减少，蓝点消失 |          |      |
| Mark all as read | 全部已读，角标归零 |          |      |
| 页面刷新持久化   | 状态保持不变       |          |      |
| 用户切换         | 数据独立           |          |      |

### ✅ 完成标准

所有测试项都通过，功能按预期工作，即可认为 Step 4 验收完成。
